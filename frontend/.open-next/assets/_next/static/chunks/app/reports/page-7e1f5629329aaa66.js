(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[22],{1390:(e,s,a)=>{"use strict";a.d(s,{A:()=>g});var t=a(95155),l=a(12115),r=a(52619),c=a.n(r),d=a(20063),n=a(61712),i=a(26617),m=a(10512),o=a(33),x=a(65229),h=a(9540);let j=[{name:"首页",href:"/",icon:n.A},{name:"商品管理",href:"/products",icon:i.A},{name:"订单管理",href:"/orders",icon:m.A},{name:"报表分析",href:"/reports",icon:o.A}];function p(){let[e,s]=(0,l.useState)(!1),a=(0,d.usePathname)();return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"lg:hidden fixed top-4 left-4 z-50",children:(0,t.jsx)("button",{onClick:()=>s(!e),className:"p-2 rounded-md bg-white shadow-md border border-gray-200",children:e?(0,t.jsx)(x.A,{className:"h-6 w-6"}):(0,t.jsx)(h.A,{className:"h-6 w-6"})})}),(0,t.jsx)("div",{className:"\n        fixed inset-y-0 left-0 z-40 w-64 bg-white shadow-lg transform transition-transform duration-300 ease-in-out\n        ".concat(e?"translate-x-0":"-translate-x-full","\n        lg:translate-x-0 lg:static lg:inset-0\n      "),children:(0,t.jsxs)("div",{className:"flex flex-col h-full",children:[(0,t.jsx)("div",{className:"flex items-center justify-center h-16 px-4 border-b border-gray-200",children:(0,t.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"电商ERP"})}),(0,t.jsx)("nav",{className:"flex-1 px-4 py-6 space-y-2",children:j.map(e=>{let l=a===e.href;return(0,t.jsxs)(c(),{href:e.href,className:"\n                    flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors duration-200\n                    ".concat(l?"bg-primary-100 text-primary-700 border-r-2 border-primary-500":"text-gray-600 hover:bg-gray-100 hover:text-gray-900","\n                  "),onClick:()=>s(!1),children:[(0,t.jsx)(e.icon,{className:"mr-3 h-5 w-5"}),e.name]},e.name)})}),(0,t.jsx)("div",{className:"px-4 py-4 border-t border-gray-200",children:(0,t.jsxs)("div",{className:"text-xs text-gray-500 text-center",children:[(0,t.jsx)("p",{children:"E-commerce ERP (Lite)"}),(0,t.jsx)("p",{children:"v0.1.0"})]})})]})}),e&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-30 lg:hidden",onClick:()=>s(!1)})]})}var u=a(37621),N=a(22663);function g(e){let{children:s}=e,[a,r]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{let e=async()=>{try{await u.ue.healthCheck(),r(!0)}catch(e){r(!1),N.Ay.error("无法连接到后端服务，请确保后端已启动")}};e();let s=setInterval(e,3e4);return()=>clearInterval(s)},[]),(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,t.jsx)("div",{className:"fixed top-4 right-4 z-50",children:(0,t.jsx)("div",{className:"\n          px-3 py-1 rounded-full text-xs font-medium\n          ".concat(a?"bg-success-100 text-success-800":"bg-danger-100 text-danger-800","\n        "),children:a?"● 已连接":"● 未连接"})}),(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)(p,{}),(0,t.jsx)("main",{className:"flex-1 lg:ml-0",children:(0,t.jsx)("div",{className:"min-h-screen",children:s})})]})]})}},5038:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>k});var t=a(95155),l=a(12115),r=a(1390),c=a(37621),d=a(22663),n=a(33),i=a(63581),m=a(1524),o=a(91761),x=a(10512),h=a(26617),j=a(26991),p=a(73850),u=a(68425),N=a(47734),g=a(73697),f=a(23508),b=a(7620),y=a(77568),v=a(78765),_=a(12235),w=a(69386);function k(){var e,s,a,k;let[A,F]=(0,l.useState)(null),[P,O]=(0,l.useState)(!0),[S,D]=(0,l.useState)(!1),[E,z]=(0,l.useState)({start_date:"",end_date:"",channels:[],payment_methods:[],statuses:[],product_skus:[]}),R=async()=>{if(E.start_date&&E.end_date&&new Date(E.start_date)>new Date(E.end_date))return void alert("开始日期不能大于结束日期！");try{O(!0);let e=Object.fromEntries(Object.entries(E).filter(e=>{let[s,a]=e;return""!==a})),s=await c.te.getComprehensiveReport(e);F(s.data)}catch(e){d.Ay.error("获取报表失败"),console.error("获取报表数据失败:",e)}finally{O(!1)}};(0,l.useEffect)(()=>{R()},[]);let I=["#3b82f6","#22c55e","#f59e0b","#ef4444","#8b5cf6"];return(0,t.jsx)(r.A,{children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[(0,t.jsx)(n.A,{className:"h-8 w-8 mr-3 text-warning-600"}),"报表分析"]}),(0,t.jsx)("p",{className:"mt-2 text-gray-600",children:"销售数据统计、利润分析和趋势预测"})]}),(0,t.jsxs)("div",{className:"mb-6 flex flex-col sm:flex-row gap-4",children:[(0,t.jsx)("div",{className:"flex-1 flex items-center text-gray-600 text-sm",children:(null==A||null==(e=A.filters_applied)?void 0:e.start_date)&&(null==A||null==(s=A.filters_applied)?void 0:s.end_date)?(0,t.jsxs)("span",{children:["时间范围：",A.filters_applied.start_date," ~ ",A.filters_applied.end_date]}):(null==A||null==(a=A.filters_applied)?void 0:a.start_date)?(0,t.jsxs)("span",{children:["时间范围：",A.filters_applied.start_date," ~ 至今"]}):(null==A||null==(k=A.filters_applied)?void 0:k.end_date)?(0,t.jsxs)("span",{children:["时间范围：所有至 ~ ",A.filters_applied.end_date]}):(0,t.jsx)("span",{children:"时间范围：所有至今"})}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)("button",{onClick:()=>D(!0),className:"btn-secondary",children:[(0,t.jsx)(i.A,{className:"h-4 w-4 mr-2"}),"筛选条件"]}),(0,t.jsxs)("button",{onClick:R,className:"btn-primary",disabled:P,children:[(0,t.jsx)(m.A,{className:"h-4 w-4 mr-2"}),P?"加载中...":"刷新数据"]})]})]}),P?(0,t.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"}),(0,t.jsx)("span",{className:"ml-2",children:"加载报表数据..."})]}):A?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,t.jsx)("div",{className:"card",children:(0,t.jsx)("div",{className:"card-body",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"p-3 rounded-lg bg-primary-100",children:(0,t.jsx)(o.A,{className:"h-6 w-6 text-primary-600"})}),(0,t.jsxs)("div",{className:"ml-4",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"总销售额"}),(0,t.jsxs)("p",{className:"text-2xl font-semibold text-gray-900",children:["\xa5",A.summary.total_sales.toFixed(2)]})]})]})})}),(0,t.jsx)("div",{className:"card",children:(0,t.jsx)("div",{className:"card-body",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"p-3 rounded-lg bg-success-100",children:(0,t.jsx)(m.A,{className:"h-6 w-6 text-success-600"})}),(0,t.jsxs)("div",{className:"ml-4",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"总利润"}),(0,t.jsxs)("p",{className:"text-2xl font-semibold text-gray-900",children:["\xa5",A.summary.total_profit.toFixed(2)]})]})]})})}),(0,t.jsx)("div",{className:"card",children:(0,t.jsx)("div",{className:"card-body",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"p-3 rounded-lg bg-warning-100",children:(0,t.jsx)(x.A,{className:"h-6 w-6 text-warning-600"})}),(0,t.jsxs)("div",{className:"ml-4",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"订单总数"}),(0,t.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:A.summary.total_orders})]})]})})}),(0,t.jsx)("div",{className:"card",children:(0,t.jsx)("div",{className:"card-body",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"p-3 rounded-lg bg-danger-100",children:(0,t.jsx)(h.A,{className:"h-6 w-6 text-danger-600"})}),(0,t.jsxs)("div",{className:"ml-4",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"利润率"}),(0,t.jsxs)("p",{className:"text-2xl font-semibold text-gray-900",children:[A.summary.profit_margin.toFixed(1),"%"]})]})]})})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("div",{className:"card-header",children:(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"销售趋势"})}),(0,t.jsx)("div",{className:"card-body",children:(0,t.jsx)("div",{className:"h-80",children:(0,t.jsx)(j.u,{width:"100%",height:"100%",children:(0,t.jsxs)(p.Q,{data:A.time_series,children:[(0,t.jsx)(u.d,{strokeDasharray:"3 3"}),(0,t.jsx)(N.W,{dataKey:"date",tickFormatter:e=>new Date(e).toLocaleDateString("zh-CN")}),(0,t.jsx)(g.h,{}),(0,t.jsx)(f.m,{formatter:(e,s)=>["\xa5".concat(e.toFixed(2)),"total_sales"===s?"销售额":"total_cost"===s?"成本":"利润"],labelFormatter:e=>new Date(e).toLocaleDateString("zh-CN")}),(0,t.jsx)(b.s,{}),(0,t.jsx)(y.G,{type:"monotone",dataKey:"total_sales",stackId:"1",stroke:"#3b82f6",fill:"#3b82f6",fillOpacity:.6}),(0,t.jsx)(y.G,{type:"monotone",dataKey:"total_profit",stackId:"2",stroke:"#22c55e",fill:"#22c55e",fillOpacity:.6})]})})})})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("div",{className:"card-header",children:(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"渠道销售对比"})}),(0,t.jsx)("div",{className:"card-body",children:(0,t.jsx)("div",{className:"h-80",children:(0,t.jsx)(j.u,{width:"100%",height:"100%",children:(0,t.jsxs)(v.r,{children:[(0,t.jsx)(_.F,{data:A.channel_stats,cx:"50%",cy:"50%",labelLine:!1,label:e=>{let{channel:s,percent:a}=e;return"".concat(s," ").concat((100*a).toFixed(0),"%")},outerRadius:80,fill:"#8884d8",dataKey:"total_sales",children:A.channel_stats.map((e,s)=>(0,t.jsx)(w.f,{fill:I[s%I.length]},"cell-".concat(s)))}),(0,t.jsx)(f.m,{formatter:e=>["\xa5".concat(e.toFixed(2)),"销售额"]})]})})})})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("div",{className:"card-header",children:(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"渠道统计"})}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"table",children:[(0,t.jsx)("thead",{className:"table-header",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"table-header-cell",children:"渠道"}),(0,t.jsx)("th",{className:"table-header-cell",children:"销售额"}),(0,t.jsx)("th",{className:"table-header-cell",children:"利润"}),(0,t.jsx)("th",{className:"table-header-cell",children:"订单数"}),(0,t.jsx)("th",{className:"table-header-cell",children:"利润率"})]})}),(0,t.jsx)("tbody",{className:"table-body",children:A.channel_stats.map((e,s)=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"table-cell",children:(0,t.jsx)("span",{className:"badge ".concat(0===s?"badge-primary":1===s?"badge-success":"badge-secondary"),children:e.channel})}),(0,t.jsxs)("td",{className:"table-cell font-medium",children:["\xa5",e.total_sales.toFixed(2)]}),(0,t.jsxs)("td",{className:"table-cell font-medium text-success-600",children:["\xa5",e.total_profit.toFixed(2)]}),(0,t.jsx)("td",{className:"table-cell",children:e.order_count}),(0,t.jsxs)("td",{className:"table-cell",children:[e.profit_margin.toFixed(1),"%"]})]},e.channel))})]})})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("div",{className:"card-header",children:(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"热销商品"})}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"table",children:[(0,t.jsx)("thead",{className:"table-header",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"table-header-cell",children:"商品"}),(0,t.jsx)("th",{className:"table-header-cell",children:"销售额"}),(0,t.jsx)("th",{className:"table-header-cell",children:"销量"}),(0,t.jsx)("th",{className:"table-header-cell",children:"利润率"})]})}),(0,t.jsx)("tbody",{className:"table-body",children:A.product_stats.slice(0,5).map((e,s)=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"table-cell",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:e.product_name}),(0,t.jsx)("div",{className:"text-sm text-gray-500 font-mono",children:e.product_sku})]})}),(0,t.jsxs)("td",{className:"table-cell font-medium",children:["\xa5",e.total_sales.toFixed(2)]}),(0,t.jsx)("td",{className:"table-cell",children:e.quantity_sold}),(0,t.jsxs)("td",{className:"table-cell",children:[e.profit_margin.toFixed(1),"%"]})]},e.product_sku))})]})})]})]}),S&&(0,t.jsx)(C,{filters:E,setFilters:z,onApply:()=>{R(),D(!1)},onReset:()=>{z({start_date:"",end_date:"",channels:[],payment_methods:[],statuses:[],product_skus:[]})},onClose:()=>D(!1)})]}):(0,t.jsx)("div",{className:"text-center py-12",children:(0,t.jsx)("p",{className:"text-gray-500",children:"暂无报表数据"})})]})})}function C(e){let{filters:s,setFilters:a,onApply:l,onReset:r,onClose:c}=e;return(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"筛选条件"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"开始日期"}),(0,t.jsx)("input",{type:"date",value:s.start_date,onChange:e=>a({...s,start_date:e.target.value}),className:"form-input"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"结束日期"}),(0,t.jsx)("input",{type:"date",value:s.end_date,onChange:e=>a({...s,end_date:e.target.value}),className:"form-input"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"销售渠道"}),(0,t.jsx)("div",{className:"space-y-2",children:["eBay","Facebook","saltFish","other"].map(e=>(0,t.jsxs)("label",{className:"flex items-center",children:[(0,t.jsx)("input",{type:"checkbox",checked:s.channels.includes(e),onChange:t=>{t.target.checked?a({...s,channels:[...s.channels,e]}):a({...s,channels:s.channels.filter(s=>s!==e)})},className:"mr-2"}),e]},e))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"支付方式"}),(0,t.jsx)("div",{className:"space-y-2",children:["cash","payid"].map(e=>(0,t.jsxs)("label",{className:"flex items-center",children:[(0,t.jsx)("input",{type:"checkbox",checked:s.payment_methods.includes(e),onChange:t=>{t.target.checked?a({...s,payment_methods:[...s.payment_methods,e]}):a({...s,payment_methods:s.payment_methods.filter(s=>s!==e)})},className:"mr-2"}),"cash"===e?"现金":"PayID"]},e))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"form-label",children:"订单状态"}),(0,t.jsx)("div",{className:"space-y-2",children:["pending","done"].map(e=>(0,t.jsxs)("label",{className:"flex items-center",children:[(0,t.jsx)("input",{type:"checkbox",checked:s.statuses.includes(e),onChange:t=>{t.target.checked?a({...s,statuses:[...s.statuses,e]}):a({...s,statuses:s.statuses.filter(s=>s!==e)})},className:"mr-2"}),"pending"===e?"待处理":"已完成"]},e))})]})]}),(0,t.jsxs)("div",{className:"flex gap-2 pt-4",children:[(0,t.jsx)("button",{onClick:l,className:"btn-primary flex-1",children:"应用筛选"}),(0,t.jsx)("button",{onClick:r,className:"btn-secondary flex-1",children:"重置"}),(0,t.jsx)("button",{onClick:c,className:"btn-secondary flex-1",children:"取消"})]})]})})}},37621:(e,s,a)=>{"use strict";a.d(s,{GQ:()=>c,N:()=>d,te:()=>n,ue:()=>i});var t=a(95125),l=a(22663);console.log("NEXT_PUBLIC_API_URL:","https://e-commerce-platform-7zg5.onrender.com");let r=t.A.create({baseURL:"https://e-commerce-platform-7zg5.onrender.com",timeout:1e4,headers:{"Content-Type":"application/json"}});r.interceptors.request.use(e=>e,e=>Promise.reject(e)),r.interceptors.response.use(e=>e,e=>{if(e.response){var s,a;let t=null==(s=e.response.data)?void 0:s.detail,r="请求失败";Array.isArray(t)?r=t.map(e=>e.msg).join("；"):"string"==typeof t?r=t:(null==(a=e.response.data)?void 0:a.message)&&(r=e.response.data.message),l.Ay.error(r)}else e.request?l.Ay.error("网络连接失败，请检查后端服务是否启动"):l.Ay.error("请求配置错误");return Promise.reject(e)});let c={getProducts:()=>r.get("/products"),getProduct:e=>r.get("/products/".concat(e)),createProduct:e=>r.post("/products",e),updateProduct:(e,s)=>r.patch("/products/".concat(e),s),deleteProduct:e=>r.delete("/products/".concat(e)),importProducts:e=>{let s=new FormData;return s.append("file",e),r.post("/products/import/csv",s,{headers:{"Content-Type":"multipart/form-data"}})}},d={getOrders:()=>r.get("/orders"),getOrder:e=>r.get("/orders/".concat(e)),getOrderByNumber:e=>r.get("/orders/by-number/".concat(e)),createOrder:e=>r.post("/orders",e),updateOrder:(e,s)=>r.patch("/orders/".concat(e),s),deleteOrder:e=>r.delete("/orders/".concat(e)),importOrders:e=>{let s=new FormData;return s.append("file",e),r.post("/orders/import/csv",s,{headers:{"Content-Type":"multipart/form-data"}})}},n={getComprehensiveReport:e=>r.post("/reports/comprehensive",e),getSalesSummary:e=>r.get("/reports/summary",{params:e}),getChannelStats:e=>r.get("/reports/channels",{params:e}),getProductStats:e=>r.get("/reports/products",{params:e}),getTimeSeriesData:e=>r.get("/reports/timeseries",{params:e})},i={healthCheck:()=>r.get("/health")}},50491:(e,s,a)=>{Promise.resolve().then(a.bind(a,5038))}},e=>{e.O(0,[663,617,317,441,255,358],()=>e(e.s=50491)),_N_E=e.O()}]);