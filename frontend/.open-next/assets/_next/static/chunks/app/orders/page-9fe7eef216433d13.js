(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[778],{1390:(e,t,r)=>{"use strict";r.d(t,{A:()=>f});var s=r(95155),a=r(12115),n=r(52619),c=r.n(n),l=r(20063),o=r(61712),d=r(26617),i=r(10512),m=r(33),u=r(65229),h=r(9540);let x=[{name:"首页",href:"/",icon:o.A},{name:"商品管理",href:"/products",icon:d.A},{name:"订单管理",href:"/orders",icon:i.A},{name:"报表分析",href:"/reports",icon:m.A}];function p(){let[e,t]=(0,a.useState)(!1),r=(0,l.usePathname)();return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"lg:hidden fixed top-4 left-4 z-50",children:(0,s.jsx)("button",{onClick:()=>t(!e),className:"p-2 rounded-md bg-white shadow-md border border-gray-200",children:e?(0,s.jsx)(u.A,{className:"h-6 w-6"}):(0,s.jsx)(h.A,{className:"h-6 w-6"})})}),(0,s.jsx)("div",{className:"\n        fixed inset-y-0 left-0 z-40 w-64 bg-white shadow-lg transform transition-transform duration-300 ease-in-out\n        ".concat(e?"translate-x-0":"-translate-x-full","\n        lg:translate-x-0 lg:static lg:inset-0\n      "),children:(0,s.jsxs)("div",{className:"flex flex-col h-full",children:[(0,s.jsx)("div",{className:"flex items-center justify-center h-16 px-4 border-b border-gray-200",children:(0,s.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"电商ERP"})}),(0,s.jsx)("nav",{className:"flex-1 px-4 py-6 space-y-2",children:x.map(e=>{let a=r===e.href;return(0,s.jsxs)(c(),{href:e.href,className:"\n                    flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors duration-200\n                    ".concat(a?"bg-primary-100 text-primary-700 border-r-2 border-primary-500":"text-gray-600 hover:bg-gray-100 hover:text-gray-900","\n                  "),onClick:()=>t(!1),children:[(0,s.jsx)(e.icon,{className:"mr-3 h-5 w-5"}),e.name]},e.name)})}),(0,s.jsx)("div",{className:"px-4 py-4 border-t border-gray-200",children:(0,s.jsxs)("div",{className:"text-xs text-gray-500 text-center",children:[(0,s.jsx)("p",{children:"E-commerce ERP (Lite)"}),(0,s.jsx)("p",{children:"v0.1.0"})]})})]})}),e&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-30 lg:hidden",onClick:()=>t(!1)})]})}var g=r(37621),y=r(22663);function f(e){let{children:t}=e,[r,n]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{let e=async()=>{try{await g.ue.healthCheck(),n(!0)}catch(e){n(!1),y.Ay.error("无法连接到后端服务，请确保后端已启动")}};e();let t=setInterval(e,3e4);return()=>clearInterval(t)},[]),(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)("div",{className:"fixed top-4 right-4 z-50",children:(0,s.jsx)("div",{className:"\n          px-3 py-1 rounded-full text-xs font-medium\n          ".concat(r?"bg-success-100 text-success-800":"bg-danger-100 text-danger-800","\n        "),children:r?"● 已连接":"● 未连接"})}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)(p,{}),(0,s.jsx)("main",{className:"flex-1 lg:ml-0",children:(0,s.jsx)("div",{className:"min-h-screen",children:t})})]})]})}},6191:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(45105).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},17758:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var s=r(95155),a=r(12115),n=r(1390),c=r(37621),l=r(22663),o=r(10512),d=r(86651),i=r(21786),m=r(6191),u=r(71360);function h(){let[e,t]=(0,a.useState)([]),[r,h]=(0,a.useState)([]),[x,p]=(0,a.useState)(!0),[g,y]=(0,a.useState)(!1),[f,j]=(0,a.useState)(null),[v,N]=(0,a.useState)(""),[b,w]=(0,a.useState)(!1),[A,k]=(0,a.useState)(null),C=async()=>{try{p(!0);let[e,r]=await Promise.all([c.N.getOrders(),c.GQ.getProducts()]),s=[...e.data].sort((e,t)=>e.transaction_date?t.transaction_date?new Date(t.transaction_date).getTime()-new Date(e.transaction_date).getTime():-1:1);t(s),h(r.data)}catch(e){console.error("获取数据失败:",e)}finally{p(!1)}};(0,a.useEffect)(()=>{C()},[]);let[P,S]=(0,a.useState)(!1),[_,O]=(0,a.useState)(0),T=async()=>{if(confirm("确定要删除当前显示的 ".concat(E.length," 个订单吗？"))){S(!0),O(0);try{let e=E.length;for(let t=0;t<e;t++)await c.N.deleteOrder(E[t].id),O(Math.round((t+1)/e*100)),await new Promise(e=>setTimeout(e,100));l.Ay.success("成功删除 ".concat(e," 个订单")),C()}catch(e){console.error("批量删除订单失败:",e),l.Ay.error("批量删除订单失败")}finally{setTimeout(()=>S(!1),800)}}},E=e.filter(e=>{var t,s;return e.order_number.toLowerCase().includes(v.toLowerCase())||(null==(t=r.find(t=>t.id===e.product_id))?void 0:t.name)&&(null==(s=r.find(t=>t.id===e.product_id))?void 0:s.name.toLowerCase().includes(v.toLowerCase()))});return(0,s.jsx)(n.A,{children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[(0,s.jsx)(o.A,{className:"h-8 w-8 mr-3 text-success-600"}),"订单管理"]}),(0,s.jsx)("p",{className:"mt-2 text-gray-600",children:"管理订单信息，自动扣减库存"})]}),(0,s.jsxs)("div",{className:"mb-6 flex flex-col sm:flex-row gap-4",children:[(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(d.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,s.jsx)("input",{type:"text",placeholder:"搜索订单号或商品名称...",value:v,onChange:e=>N(e.target.value),className:"form-input pl-10"})]})}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)("button",{onClick:()=>w(!0),className:"btn-secondary",children:[(0,s.jsx)(i.A,{className:"h-4 w-4 mr-2"}),"导入CSV"]}),(0,s.jsxs)("button",{onClick:()=>{j(null),y(!0)},className:"btn-success",children:[(0,s.jsx)(m.A,{className:"h-4 w-4 mr-2"}),"新增订单"]}),(0,s.jsxs)("button",{onClick:T,className:"btn-danger",children:[(0,s.jsx)(u.A,{className:"h-4 w-4 mr-2"}),"批量删除"]})]})]}),P&&(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded h-3",children:(0,s.jsx)("div",{className:"bg-red-500 h-3 rounded transition-all duration-300",style:{width:"".concat(_,"%")}})}),(0,s.jsxs)("p",{className:"text-sm mt-2 text-gray-600",children:["正在删除订单... ",_,"%"]})]})]})})}},21786:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(45105).A)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},37621:(e,t,r)=>{"use strict";r.d(t,{GQ:()=>c,N:()=>l,te:()=>o,ue:()=>d});var s=r(95125),a=r(22663);console.log("NEXT_PUBLIC_API_URL:","https://e-commerce-platform-7zg5.onrender.com");let n=s.A.create({baseURL:"https://e-commerce-platform-7zg5.onrender.com",timeout:1e4,headers:{"Content-Type":"application/json"}});n.interceptors.request.use(e=>e,e=>Promise.reject(e)),n.interceptors.response.use(e=>e,e=>{if(e.response){var t,r;let s=null==(t=e.response.data)?void 0:t.detail,n="请求失败";Array.isArray(s)?n=s.map(e=>e.msg).join("；"):"string"==typeof s?n=s:(null==(r=e.response.data)?void 0:r.message)&&(n=e.response.data.message),a.Ay.error(n)}else e.request?a.Ay.error("网络连接失败，请检查后端服务是否启动"):a.Ay.error("请求配置错误");return Promise.reject(e)});let c={getProducts:()=>n.get("/products"),getProduct:e=>n.get("/products/".concat(e)),createProduct:e=>n.post("/products",e),updateProduct:(e,t)=>n.patch("/products/".concat(e),t),deleteProduct:e=>n.delete("/products/".concat(e)),importProducts:e=>{let t=new FormData;return t.append("file",e),n.post("/products/import/csv",t,{headers:{"Content-Type":"multipart/form-data"}})}},l={getOrders:()=>n.get("/orders"),getOrder:e=>n.get("/orders/".concat(e)),getOrderByNumber:e=>n.get("/orders/by-number/".concat(e)),createOrder:e=>n.post("/orders",e),updateOrder:(e,t)=>n.patch("/orders/".concat(e),t),deleteOrder:e=>n.delete("/orders/".concat(e)),importOrders:e=>{let t=new FormData;return t.append("file",e),n.post("/orders/import/csv",t,{headers:{"Content-Type":"multipart/form-data"}})}},o={getComprehensiveReport:e=>n.post("/reports/comprehensive",e),getSalesSummary:e=>n.get("/reports/summary",{params:e}),getChannelStats:e=>n.get("/reports/channels",{params:e}),getProductStats:e=>n.get("/reports/products",{params:e}),getTimeSeriesData:e=>n.get("/reports/timeseries",{params:e})},d={healthCheck:()=>n.get("/health")}},71360:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(45105).A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},84203:(e,t,r)=>{Promise.resolve().then(r.bind(r,17758))},86651:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(45105).A)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])}},e=>{e.O(0,[663,617,441,255,358],()=>e(e.s=84203)),_N_E=e.O()}]);